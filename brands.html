<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Brands</title>
    <link rel="stylesheet" href="style_test.css">
</head>
<body>
    <header>
        <div class="header-top">
            <a href="#" class="header-logo" onclick="location.href='cars.html'">
                CarAPI
            </a>
            <div class="header-right">
                <a href="user_profile.html" class="profile-link">John Doe</a>
                <button class="logout-button" onclick="location.href='register_or_login.html'">
                    Log out
                </button>
                <button class="menu-toggle-button">&#9776;</button>
            </div>
        </div>
        <div class="header-bottom">
            <span>Search by: </span>
            <div class="tabs">
                <button class="tab-button active" onclick="location.href='brands.html'">Brand</button>
                <button class="tab-button" onclick="location.href='models.html'">Model</button>
                <button class="tab-button" onclick="location.href='cars.html'">Car</button>
            </div>
        </div>
    </header>

    <script>
        function filterBrands() {
            const brandName = document.getElementById("brand-filter").value;
            const headquartersCountry = document.getElementById("country-filter").value;

            // Construct the URL with the filter parameters
            let url = "http://127.0.0.1:8000/brands/?";

            if (brandName) {
                url += "brand_name=" + encodeURIComponent(brandName) + "&";
            }

            if (headquartersCountry) {
                url += "headquarters_country=" + encodeURIComponent(headquartersCountry) + "&";
            }

            // Remove the trailing '&' character
            url = url.slice(0, -1);

            // Fetch data from the URL
            fetchAndGenerateBrandInstances(url);
        }

        function fetchAndGenerateBrandInstances(url) {
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    // Clear previous instances
                    const instancesContainer = document.getElementById("instances-container");
                    instancesContainer.innerHTML = "";

                    // Generate instances based on the fetched data
                    data.forEach(instance => {
                        const instanceDetails = document.createElement("div");
                        instanceDetails.className = "instance-details";
                        instanceDetails.id = "brand-details-" + instance.id;

                        const brandNameParagraph = document.createElement("p");
                        brandNameParagraph.innerText = "Brand Name: " + instance.brand_name;
                        instanceDetails.appendChild(brandNameParagraph);

                        const headquartersCountryParagraph = document.createElement("p");
                        headquartersCountryParagraph.innerText = "Headquarters Country: " + instance.headquarters_country;
                        instanceDetails.appendChild(headquartersCountryParagraph);

                        instancesContainer.appendChild(instanceDetails);
                    });
                })
                .catch(error => {
                    alert("Error fetching data");
                });
        }

        function resetBrandFilters() {
            // Clear filter input fields
            document.getElementById("brand-filter").value = "";
            document.getElementById("country-filter").value = "";

            // Reset URL to fetch all instances
            const url = "http://127.0.0.1:8000/brands/";

            // Fetch data from the reset URL
            fetchAndGenerateBrandInstances(url);
        }

        window.onload = function () {
            const initialUrl = "http://127.0.0.1:8000/brands/";
            fetchAndGenerateBrandInstances(initialUrl);
        };
    </script>

    <h1>Filter by Brand</h1>
    <form>
        <label for="brand-filter">Brand Name:</label>
        <input type="text" id="brand-filter" name="brand-filter" placeholder="Enter brand name"><br>

        <label for="country-filter">Headquarters Country:</label>
        <input type="text" id="country-filter" name="country-filter" placeholder="Enter country name"><br>

        <div class="button-container">
            <button type="button" class="cancel" onclick="resetBrandFilters()">Reset</button>
            <button type="button" class="ok" onclick="filterBrands()">Apply Filter</button>
        </div>
    </form>

    <div id="instances-container"></div>

</body>
</html>