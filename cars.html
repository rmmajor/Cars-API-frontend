<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cars</title>
    <link rel="stylesheet" href="style_test.css">
</head>
<body>
    <header>
      <div class="header-top">
        <a href="#" class="header-logo" onclick="location.href='cars.html'">
          CarAPI
        </a>
        <div class="header-right">
          <a href="user_profile.html" class="profile-link">John Doe</a>
          <button class="logout-button" onclick="location.href='register_or_login.html'">
              Log out
          </button>
          <button class="menu-toggle-button">&#9776;</button>
        </div>
      </div>
      <div class="header-bottom">
        <span>Search by: </span>
        <div class="tabs">
          <button class="tab-button" onclick="location.href='brands.html'">Brand</button>
          <button class="tab-button" onclick="location.href='models.html'">Model</button>
          <button class="tab-button active" onclick="location.href='cars.html'">Car</button>
        </div>
      </div>
    </header>

    <script>
        function fetchBrands() {
            const url = "http://127.0.0.1:8000/brands/";
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const brandFilter = document.getElementById("brand-filter");
                    brandFilter.innerHTML = ""; // Clear previous options

                    const allOption = document.createElement("option");
                    allOption.value = "";
                    allOption.textContent = "All";
                    brandFilter.appendChild(allOption);

                    data.forEach(brand => {
                        const option = document.createElement("option");
                        option.value = brand.brand_name;
                        option.textContent = brand.brand_name;
                        brandFilter.appendChild(option);
                    });
                })
                .catch(error => {
                    alert(`Error fetching brands: ${error}`);
                });
        }

        function fetchModels() {
            const url = "http://127.0.0.1:8000/models/";
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const modelFilter = document.getElementById("model-filter");
                    modelFilter.innerHTML = ""; // Clear previous options

                    const allOption = document.createElement("option");
                    allOption.value = "";
                    allOption.textContent = "All";
                    modelFilter.appendChild(allOption);

                    data.forEach(model => {
                        const option = document.createElement("option");
                        option.value = model.model_name;
                        option.textContent = model.model_name;
                        modelFilter.appendChild(option);
                    });
                })
                .catch(error => {
                    alert("Error fetching models");
                });
        }

        function fetchCars() {
            const url = "http://127.0.0.1:8000/cars/";
            fetchAndGenerateCarInstances(url);
        }

        function fetchAndGenerateCarInstances(url) {
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const instancesContainer = document.getElementById("car-instances-container");
                    instancesContainer.innerHTML = ""; // Clear previous instances

                    data.forEach(car => {
                        const carDetails = document.createElement("div");
                        carDetails.classList.add("instance-details");

                        // brand
                        const brandParagraph = document.createElement("p");
                        carDetails.appendChild(brandParagraph);

                        fetch('http://127.0.0.1:8000/brands/' + car.brand + '/')
                            .then(response => response.json())
                            .then(data => {
                                brandParagraph.textContent = "Brand: " + data.brand_name;
                            })
                            .catch(error => {
                                alert(`Error: ${error}`);
                            });

                        // model
                        const modelParagraph = document.createElement("p");
                        carDetails.appendChild(modelParagraph);

                        fetch('http://127.0.0.1:8000/models/' + car.model + '/')
                            .then(response => response.json())
                            .then(data => {
                                modelParagraph.textContent = "Model: " + data.model_name;
                            })
                            .catch(error => {
                                alert(`Error: ${error}`);
                            });

                        const priceParagraph = document.createElement("p");
                        priceParagraph.textContent = "Price: " + car.price;
                        carDetails.appendChild(priceParagraph);

                        const mileageParagraph = document.createElement("p");
                        mileageParagraph.textContent = "Mileage: " + car.mileage;
                        carDetails.appendChild(mileageParagraph);

                        const exteriorColorParagraph = document.createElement("p");
                        exteriorColorParagraph.textContent = "Exterior Color: " + car.exterior_color;
                        carDetails.appendChild(exteriorColorParagraph);

                        const interiorColorParagraph = document.createElement("p");
                        interiorColorParagraph.textContent = "Interior Color: " + car.interior_color;
                        carDetails.appendChild(interiorColorParagraph);

                        const fuelTypeParagraph = document.createElement("p");
                        fuelTypeParagraph.textContent = "Fuel Type: " + car.fuel_type;
                        carDetails.appendChild(fuelTypeParagraph);

                        const transmissionParagraph = document.createElement("p");
                        transmissionParagraph.textContent = "Transmission: " + car.transmission;
                        carDetails.appendChild(transmissionParagraph);

                        const engineParagraph = document.createElement("p");
                        engineParagraph.textContent = "Engine: " + car.engine;
                        carDetails.appendChild(engineParagraph);

                        const onSaleParagraph = document.createElement("p");
                        onSaleParagraph.textContent = "On Sale: " + (car.is_on_sale ? "Yes" : "No");
                        carDetails.appendChild(onSaleParagraph);

                        instancesContainer.appendChild(carDetails);
                    });
                })
                .catch(error => {
                    alert("Error fetching car instances");
                });
        }

        function filterCars() {
            const brandFilter = document.getElementById("brand-filter").value;
            const modelFilter = document.getElementById("model-filter").value;
            const priceFilter = document.getElementById("price-filter").value;
            const mileageFilter = document.getElementById("mileage-filter").value;
            const exteriorColorFilter = document.getElementById("exterior-color-filter").value;
            const interiorColorFilter = document.getElementById("interior-color-filter").value;
            const fuelTypeFilter = document.getElementById("fuel-type-filter").value;
            const transmissionFilter = document.getElementById("transmission-filter").value;
            const engineFilter = document.getElementById("engine-filter").value;
            const isOnSaleFilter = document.getElementById("is-on-sale-filter").checked;

            let url = "http://127.0.0.1:8000/cars/";

            if (!isOnSaleFilter) {
                url += "all/";
            }
            url += "?";

            // add filters to url
            if (brandFilter) {
                url += "brand_name=" + encodeURIComponent(brandFilter) + "&";
            }
            if (modelFilter) {
                url += "model_name=" + encodeURIComponent(modelFilter) + "&";
            }

            if (priceFilter) {
                url += "price=" + encodeURIComponent(priceFilter) + "&";
            }
            if (mileageFilter) {
                url += "mileage=" + encodeURIComponent(mileageFilter) + "&";
            }
            if (exteriorColorFilter) {
                url += "exterior_color=" + encodeURIComponent(exteriorColorFilter) + "&";
            }
            if (interiorColorFilter) {
                url += "interior_color=" + encodeURIComponent(interiorColorFilter) + "&";
            }
            if (fuelTypeFilter) {
                url += "fuel_type=" + encodeURIComponent(fuelTypeFilter) + "&";
            }
            if (transmissionFilter) {
                url += "transmission=" + encodeURIComponent(transmissionFilter) + "&";
            }
            if (engineFilter) {
                url += "engine=" + encodeURIComponent(engineFilter) + "&";
            }

            // Remove the trailing '&' character
            url = url.slice(0, -1);
            console.log(url);
            fetchAndGenerateCarInstances(url);
        }

        function resetFilters() {
            document.getElementById("brand-filter").value = "";
            document.getElementById("model-filter").value = "";
            document.getElementById("price-filter").value = "";
            document.getElementById("mileage-filter").value = "";
            document.getElementById("exterior-color-filter").value = "";
            document.getElementById("interior-color-filter").value = "";
            document.getElementById("fuel-type-filter").value = "";
            document.getElementById("transmission-filter").value = "";
            document.getElementById("engine-filter").value = "";
            document.getElementById("is-on-sale-filter").checked = true;

            fetchBrands();
            fetchModels();
            fetchCars();
        }

        fetchBrands();
        fetchModels();
        fetchCars();
    </script>

    <h1>Cars Filter</h1>
    <form>
        <label for="brand-filter">Brand:</label>
        <select id="brand-filter">
            <option value="">All</option>
        </select><br>

        <label for="model-filter">Model:</label>
        <select id="model-filter">
            <option value="">All</option>
        </select><br>

        <label for="price-filter">Price:</label>
        <input type="number" id="price-filter" name="price-filter" placeholder="Enter maximum price"><br>

        <label for="mileage-filter">Mileage:</label>
        <input type="number" id="mileage-filter" name="mileage-filter" placeholder="Enter maximum mileage"><br>

        <label for="exterior-color-filter">Exterior Color:</label>
        <input type="text" id="exterior-color-filter" name="exterior-color-filter" placeholder="Enter exterior color"><br>

        <label for="interior-color-filter">Interior Color:</label>
        <input type="text" id="interior-color-filter" name="interior-color-filter" placeholder="Enter interior color"><br>

        <label for="fuel-type-filter">Fuel Type:</label>
        <input type="text" id="fuel-type-filter" name="fuel-type-filter" placeholder="Enter fuel type"><br>

        <label for="transmission-filter">Transmission:</label>
        <select id="transmission-filter">
            <option value="">All</option>
            <option value="Automatic">Automatic</option>
            <option value="Manual">Manual</option>
            <option value="CVT">CVT</option>
        </select><br>

        <label for="engine-filter">Engine:</label>
        <input type="text" id="engine-filter" name="engine-filter" placeholder="Enter engine"><br>

        <label for="is-on-sale-filter">On Sale:</label>
        <input type="checkbox" id="is-on-sale-filter" name="is-on-sale-filter" checked><br>

        <div class="button-container">
            <button type="button" class="cancel" onclick="resetFilters()">Reset</button>
            <button type="button" class="ok" onclick="filterCars()">Apply Filter</button>
        </div>
    </form>

    <h1>Cars Found</h1>
    <div id="car-instances-container"></div>

</body>
</html>
